// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider  = "postgresql"
    url       = env("DATABASE_URL")
    directUrl = env("DIRECT_URL")
}

enum ItemType {
    RAW_MATERIAL
    SEMI_FINISHED_GOOD
    FINISHED_GOOD
    PAINT_ACCESSORIES
}

model PaintGrade {
    id           String        @id @default(uuid())
    name         String
    description  String?
    createdAt    DateTime      @default(now())
    updatedAt    DateTime      @updatedAt
    rawMaterials RawMaterial[]
}

model Supplier {
    id               String             @id @default(uuid())
    name             String
    description      String?
    createdAt        DateTime           @default(now())
    updatedAt        DateTime           @updatedAt
    RawMaterial      RawMaterial[]
    PaintAccessories PaintAccessories[]
}

model User {
    id               String             @id @default(uuid())
    name             String
    username         String
    password         String
    token            String?
    tokenExpiresAt   DateTime?
    createdAt        DateTime           @default(now())
    updatedAt        DateTime           @updatedAt
    RawMaterial      RawMaterial[]
    SemiFinishedGood SemiFinishedGood[]
    FinishedGood     FinishedGood[]
    PaintAccessories PaintAccessories[]
    returnedItems    ReturnedItem[]
}

model RawMaterial {
    id                     String                   @id @default(uuid())
    supplierId             String
    supplier               Supplier                 @relation(fields: [supplierId], references: [id])
    userId                 String
    user                   User                     @relation(fields: [userId], references: [id])
    paintGradeId           String
    paintGrade             PaintGrade               @relation(fields: [paintGradeId], references: [id])
    name                   String
    qty                    Int
    materialType           String // LEM, THINNER, DLL
    supplierPrice          Float
    sellingPrice           Float
    createdAt              DateTime                 @default(now())
    updatedAt              DateTime                 @updatedAt
    SemiFinishedGoodDetail SemiFinishedGoodDetail[]
    finishedGoodDetails    FinishedGoodDetail[]
}

model SemiFinishedGood {
    id                     String                   @id @default(uuid())
    userId                 String
    user                   User                     @relation(fields: [userId], references: [id])
    name                   String
    qty                    Int
    SemiFinishedGoodDetail SemiFinishedGoodDetail[]
    createdAt              DateTime                 @default(now())
    updatedAt              DateTime                 @updatedAt
}

model SemiFinishedGoodDetail {
    id                 String           @id @default(uuid())
    semiFinishedGoodId String
    semiFinishedGood   SemiFinishedGood @relation(fields: [semiFinishedGoodId], references: [id])
    rawMaterialId      String
    rawMaterial        RawMaterial      @relation(fields: [rawMaterialId], references: [id])
    qty                Int
    createdAt          DateTime         @default(now())
    updatedAt          DateTime         @updatedAt
}

model FinishedGood {
    id                  String               @id @default(uuid())
    productionCode      String               @unique
    userId              String
    user                User                 @relation(fields: [userId], references: [id])
    name                String
    qty                 Int
    batchNumber         String
    quality             String // BAGUS, ETC
    dateProduced        DateTime             @default(now())
    createdAt           DateTime             @default(now())
    updatedAt           DateTime             @updatedAt
    finishedGoodDetails FinishedGoodDetail[]
    returnedItems       ReturnedItem[]
}

model FinishedGoodDetail {
    id             String       @id @default(uuid())
    finishedGoodId String
    finishedGood   FinishedGood @relation(fields: [finishedGoodId], references: [id])
    rawMaterialId  String
    rawMaterial    RawMaterial  @relation(fields: [rawMaterialId], references: [id])
    qty            Int
    createdAt      DateTime
    updatedAt      DateTime
}

model PaintAccessories {
    id            String   @id @default(uuid())
    name          String
    supplierId    String
    supplier      Supplier @relation(fields: [supplierId], references: [id])
    userId        String
    user          User     @relation(fields: [userId], references: [id])
    supplierPrice Float
    sellingPrice  Float
    qty           Int
    createdAt     DateTime @default(now())
    updatedAt     DateTime @updatedAt
}

model ReturnedItem {
    id             String       @id @default(uuid())
    // itemType    ItemType
    userId         String
    user           User         @relation(fields: [userId], references: [id])
    finishedGoodId String
    finishedGood   FinishedGood @relation(fields: [finishedGoodId], references: [id])
    qty            Int
    from           String
    description    String?
    createdAt      DateTime     @default(now())
    updatedAt      DateTime     @updatedAt
}

model Selling {
    id        String   @id @default(uuid())
    qty       Int
    itemType  ItemType
    itemId    String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Buying {
    id        String   @id @default(uuid())
    qty       Int
    itemType  ItemType
    itemId    String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}
